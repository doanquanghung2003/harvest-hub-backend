spring.application.name=harvest-hub-backend
# PORT environment variable được set bởi hosting platform (Render, Railway, Fly.io)
# Nếu không có PORT thì dùng 8081 (local development)
server.port=${PORT:8081}
# Bind server to all network interfaces (0.0.0.0) để cho phép truy cập từ các thiết bị khác trong mạng
server.address=0.0.0.0

# OAuth2 client auto-configuration
# Nếu GOOGLE_CLIENT_ID không được set, OAuth2 sẽ tự động disable
# Không cần exclude nữa vì Spring Boot sẽ tự xử lý khi thiếu config

spring.security.user.name=admin
spring.security.user.password=admin

# MongoDB Configuration
# ==========================================
# Để chuyển từ ONLINE (Atlas) sang OFFLINE (Local):
# 1. Comment dòng ONLINE và uncomment dòng OFFLINE
# 2. Đảm bảo MongoDB Local đã cài đặt và chạy (port 27017)
# 3. Xem file MONGODB_MIGRATION_GUIDE.md để biết chi tiết

# ONLINE - MongoDB Atlas (Cloud) - ĐÃ TẮT (OFFLINE)
# spring.data.mongodb.uri=mongodb+srv://dhw972300:wdkdHhUOYAqfqRVJ@cluster.zblypgw.mongodb.net/harvesthub?retryWrites=true&w=majority&appName=Cluster&tlsInsecure=true&connectTimeoutMS=60000&socketTimeoutMS=60000&serverSelectionTimeoutMS=60000

# OFFLINE - MongoDB Local (ĐANG DÙNG - CHẠY KHÔNG CẦN INTERNET)
spring.data.mongodb.uri=mongodb://localhost:27017/harvesthub

# Swagger/OpenAPI Configuration
# Temporarily disabled due to version incompatibility with Spring Boot 3.5.3
springdoc.api-docs.enabled=false
springdoc.swagger-ui.enabled=false
# springdoc.api-docs.path=/api-docs
# springdoc.swagger-ui.path=/swagger-ui.html
# springdoc.swagger-ui.operationsSorter=method
# springdoc.swagger-ui.tagsSorter=alpha
# springdoc.swagger-ui.tryItOutEnabled=true

spring.data.mongodb.database=harvesthub
spring.data.mongodb.auto-index-creation=true
spring.data.mongodb.connection-pool.max-size=100
spring.data.mongodb.connection-pool.min-size=5
spring.data.mongodb.connection-pool.max-wait-time=30000
spring.data.mongodb.connection-pool.max-connection-life-time=300000

# MongoDB connection timeout (tăng thời gian timeout)
spring.data.mongodb.connection-timeout=60000
spring.data.mongodb.socket-timeout=60000
spring.data.mongodb.server-selection-timeout=60000
spring.data.mongodb.heartbeat-frequency=10000
spring.data.mongodb.heartbeat-connect-timeout=30000
spring.data.mongodb.heartbeat-socket-timeout=30000

# Logging configuration
logging.level.com.example.harvesthubbackend=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.web=DEBUG
logging.level.org.springframework.data.mongodb=DEBUG
logging.level.org.springframework.web.multipart=DEBUG
logging.level.org.apache.tomcat=DEBUG

# Frontend base URL để tạo link email (cập nhật port cho phù hợp)
# Frontend đang chạy local (cập nhật port cho đúng với frontend của bạn)
frontend.base-url=http://localhost:8082

# Multipart upload configuration - FIXED FOR MULTIPLE IMAGES
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=100MB
spring.servlet.multipart.file-size-threshold=0
spring.servlet.multipart.location=${java.io.tmpdir}
spring.servlet.multipart.resolve-lazily=false

# Tomcat multipart configuration - FIXED FOR MULTIPLE IMAGES
server.tomcat.max-http-form-post-size=100MB
server.tomcat.max-swallow-size=100MB
server.tomcat.max-connections=8192
server.tomcat.max-http-header-size=16KB
server.tomcat.max-http-post-size=100MB
server.tomcat.max-parameter-count=1000

# Apache Commons FileUpload settings - FIXED FOR MULTIPLE IMAGES
org.apache.tomcat.util.http.fileupload.FileUploadBase.fileCountMax=1000
org.apache.tomcat.util.http.fileupload.FileUploadBase.fileSizeMax=52428800
org.apache.tomcat.util.http.fileupload.FileUploadBase.sizeMax=104857600

# Mail (Gmail SMTP) - set your credentials or use environment variables
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=${MAIL_USERNAME:}
spring.mail.password=${MAIL_PASSWORD:}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.from=${MAIL_FROM:no-reply@harvest-hub.local}

# WebSocket allowed origins (dev + preview)
app.websocket.allowed-origins=http://localhost:8082,http://127.0.0.1:8082,http://localhost:5173,http://127.0.0.1:5173,http://localhost:3000,http://127.0.0.1:3000

# VNPay Configuration
# ==========================================
# MODE: DEMO hoặc PRODUCTION
# - DEMO: Sử dụng Mock Payment Service để test (không cần tài khoản VNPay)
# - PRODUCTION: Sử dụng VNPay thực tế (cần đăng ký tài khoản)
#
# Để sử dụng VNPay thực tế (PRODUCTION):
# 1. Đăng ký tài khoản tại https://sandbox.vnpayment.vn/ (hoặc liên hệ VNPay)
# 2. Lấy TMN Code và Hash Secret từ tài khoản
# 3. Cập nhật các giá trị bên dưới (thay DEMO bằng giá trị thực)
# 4. Cập nhật vnp.returnUrl với URL frontend của bạn
#
# Hiện tại đang dùng MODE: DEMO (Mock Payment)
vnpay.tmnCode=${VNPAY_TMN_CODE:DEMO}
vnpay.hashSecret=${VNPAY_HASH_SECRET:DEMO}
# URL VNPay Sandbox - sử dụng http:// không phải https://
vnpay.url=${VNPAY_URL:http://sandbox.vnpayment.vn/paymentv2/vpcpay.html}
vnpay.returnUrl=${VNPAY_RETURN_URL:http://localhost:5173/payment/return}

# Mock Payment Configuration (dùng khi vnpay.tmnCode = DEMO)
# Cập nhật port cho đúng với frontend của bạn
# Frontend đang chạy trên port 8082 (theo vite.config.ts)
mock.payment.baseUrl=${MOCK_PAYMENT_BASE_URL:http://localhost:8082}
mock.payment.returnUrl=${MOCK_PAYMENT_RETURN_URL:http://localhost:8082/payment/return}

# OAuth2 Configuration
# ==========================================
# NOTE: OAuth2 is disabled by default when GOOGLE_CLIENT_ID is empty or not set
# To enable OAuth2, set GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET environment variables
# Hoặc uncomment và điền giá trị bên dưới:
#
# ⚠️ SECURITY WARNING: Không commit Client Secret vào Git!
# Tốt nhất là sử dụng environment variables cho production:
#   GOOGLE_CLIENT_ID=your-client-id
#   GOOGLE_CLIENT_SECRET=your-client-secret

# Google OAuth2 Client Registration
# Sử dụng environment variables: GOOGLE_CLIENT_ID và GOOGLE_CLIENT_SECRET
# Set environment variables trước khi chạy ứng dụng (xem file set-oauth2-env.bat)
spring.security.oauth2.client.registration.google.client-id=${GOOGLE_CLIENT_ID:}
spring.security.oauth2.client.registration.google.client-secret=${GOOGLE_CLIENT_SECRET:}
spring.security.oauth2.client.registration.google.scope=openid,profile,email
spring.security.oauth2.client.registration.google.redirect-uri={baseUrl}/login/oauth2/code/{registrationId}

# Google OAuth2 Provider Configuration
spring.security.oauth2.client.provider.google.authorization-uri=https://accounts.google.com/o/oauth2/v2/auth
spring.security.oauth2.client.provider.google.token-uri=https://oauth2.googleapis.com/token
spring.security.oauth2.client.provider.google.user-info-uri=https://www.googleapis.com/oauth2/v2/userinfo
spring.security.oauth2.client.provider.google.user-name-attribute=sub